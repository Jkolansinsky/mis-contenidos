<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EasyScreen con Flash Informativo</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #000;
      height: 100vh;
      overflow: hidden;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #media-container {
      width: 100%;
      height: calc(100vh - 100px); /* Ajustar si se modifica la cinta */
      display: flex;
      justify-content: center;
      align-items: center;
      background: #111;
      border-radius: 10px;
      overflow: hidden;
      position: relative; /* Para que los elementos absolutos se posicionen respecto a este */
    }
    /* Fondos para diferentes condiciones clim√°ticas en el flash */
     
   .flash-bg.clear-sky {
  background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)),
              url('https://github.com/Jkolansinsky/mis-contenidos/blob/main/Publimpresto/imgClima/despejado.jpg?raw=true') center/cover no-repeat;
}
    
    .flash-bg.partly-cloudy {
      background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), 
              url('https://github.com/Jkolansinsky/mis-contenidos/blob/main/Publimpresto/imgClima/Parcialmente%20nublado.jpg?raw=true') center/cover no-repeat;
    }
    
    .flash-bg.cloudy, .flash-bg.overcast {
      background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), 
              url('https://github.com/Jkolansinsky/mis-contenidos/blob/main/Publimpresto/imgClima/cubierto.jpg?raw=true') center/cover no-repeat;
    }
    
    .flash-bg.rain, .flash-bg.drizzle {
      background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), 
              url('https://github.com/Jkolansinsky/mis-contenidos/blob/main/Publimpresto/imgClima/lluvia.jpg?raw=true') center/cover no-repeat;
    }
    
    .flash-bg.snow, .flash-bg.sleet {
      background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), 
              url('https://github.com/Jkolansinsky/mis-contenidos/blob/main/Publimpresto/imgClima/nieve.jpg?raw=true') center/cover no-repeat; /* Misma imagen que lluvia para ejemplo */
    }
    
    .flash-bg.thunderstorm {
      background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), 
              url('https://github.com/Jkolansinsky/mis-contenidos/blob/main/Publimpresto/imgClima/tormenta.jpg?raw=true') center/cover no-repeat; /* Misma imagen que despejado para ejemplo */
    }
    
    .flash-bg.fog {
      background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), 
              url('https://github.com/Jkolansinsky/mis-contenidos/blob/main/Publimpresto/imgClima/niebla.jpg?raw=true') center/cover no-repeat;
    }
    
    .flash-bg.default {
      background: linear-gradient(135deg, #1a2a6c, #2c3e50); /* Fondo por defecto original */
    }
    .media-item {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      width: auto;
      height: auto;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    video {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      width: auto;
      height: auto;
    }
    /* Estilos para el flash informativo */
    #info-flash {
      display: none; /* Inicialmente oculto */
      width: 100%;
      height: 100%;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      text-align: center;
      padding: 20px;
      /* background: linear-gradient(135deg, #1a2a6c, #2c3e50); El fondo ahora es din√°mico */
      position: relative; /* Para contener elementos absolutos si fuera necesario */
    }
    .flash-time {
      font-size: 5em; /* Muy grande para visibilidad */
      font-weight: bold;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    .flash-date {
      font-size: 2em;
      margin-bottom: 30px;
      opacity: 0.9;
    }
    .flash-weather {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 1.8em;
    }
    .flash-city {
      font-size: 1.5em;
      color: #ffcc00;
      margin-bottom: 15px;
    }
    .flash-temp {
      font-size: 2em;
      font-weight: bold;
      margin: 10px 0;
    }
    .flash-weather-icon {
      font-size: 3em;
      margin: 15px 0;
    }
    .flash-weather-desc {
      font-size: 1.2em;
      margin: 10px 0;
      text-transform: capitalize;
    }
    .flash-wind {
      font-size: 1em;
      opacity: 0.8;
    }
    /* Cinta de avisos (mantenida) */
    #bottom-container {
      height: 90px;
      background: #000;
      border-top: 2px solid #333;
      display: flex;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 0 20px;
    }
    #ticker-container {
      flex: 1;
      display: flex;
      align-items: center;
      overflow: hidden;
      background: rgba(0,0,0,0.5);
      border-radius: 8px;
    }
    #ticker-content {
      display: flex;
      animation: ticker-animation 80s linear infinite;
      white-space: nowrap;
      padding: 0 20px;
    }
    .ticker-item {
      color: white;
      font-size: 42px;
      font-weight: bold;
      margin-right: 50px;
      display: flex;
      align-items: center;
    }
    .ticker-item::before {
      content: "‚òÖ";
      margin-right: 10px;
      color: #ffcc00;
    }
    @keyframes ticker-animation {
      0% {
        transform: translateX(100%);
      }
      100% {
        transform: translateX(-100%);
      }
    }
    #loading {
      color: white;
      font-size: 1.5em;
    }
    
    /* Estilos para el bot√≥n de inicio */
    #start-button-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
    }
    
    #start-button {
      padding: 20px 40px;
      font-size: 2em;
      background: linear-gradient(45deg, #2c3e50, #3498db);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 0 20px rgba(52, 152, 219, 0.5);
      transition: all 0.3s ease;
    }
    
    #start-button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(52, 152, 219, 0.8);
    }
    
    #start-button:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body>
  <div id="media-container">
    <div id="start-button-container">
      <button id="start-button">Iniciar Presentaci√≥n</button>
    </div>
    <div id="loading">Cargando contenido...</div>
    <!-- Flash informativo -->
    <div id="info-flash">
      <div class="flash-time" id="flash-time">00:00:00</div>
      <div class="flash-date" id="flash-date">Cargando fecha...</div>
      <div class="flash-weather">
        <div class="flash-city" id="flash-city">Cargando ciudad...</div>
        <div class="flash-weather-icon" id="flash-weather-icon">üå°Ô∏è</div>
        <div class="flash-temp" id="flash-temp">--¬∞C</div>
        <div class="flash-weather-desc" id="flash-weather-desc">Cargando clima...</div>
        <div class="flash-wind" id="flash-wind">Viento: -- km/h</div>
      </div>
    </div>
  </div>
  <!-- Cinta de avisos -->
  <div id="bottom-container">
    <div id="ticker-container">
      <div id="ticker-content"></div>
    </div>
  </div>
  <script>
    // Configuraci√≥n - CAMBIA ESTOS VALORES
    const GITHUB_USER = 'Jkolansinsky';
    const REPO_NAME = 'mis-contenidos';
    // Mapa de c√≥digos de clima con clase de fondo
    const weatherMap = {
      0: { desc: "Despejado", icon: "‚òÄÔ∏è", bgClass: "clear-sky" },
      1: { desc: "Parcialmente nublado", icon: "‚õÖ", bgClass: "partly-cloudy" },
      2: { desc: "Nublado", icon: "‚òÅÔ∏è", bgClass: "cloudy" },
      3: { desc: "Cubierto", icon: "‚òÅÔ∏è", bgClass: "overcast" },
      45: { desc: "Niebla", icon: "üå´Ô∏è", bgClass: "fog" },
      48: { desc: "Niebla helada", icon: "üå´Ô∏è", bgClass: "fog" },
      51: { desc: "Llovizna ligera", icon: "üå¶Ô∏è", bgClass: "drizzle" },
      53: { desc: "Llovizna", icon: "üå¶Ô∏è", bgClass: "drizzle" },
      55: { desc: "Llovizna intensa", icon: "üå¶Ô∏è", bgClass: "drizzle" },
      56: { desc: "Llovizna helada ligera", icon: "üåßÔ∏è", bgClass: "sleet" },
      57: { desc: "Llovizna helada", icon: "üåßÔ∏è", bgClass: "sleet" },
      61: { desc: "Lluvia ligera", icon: "üåßÔ∏è", bgClass: "rain" },
      63: { desc: "Lluvia", icon: "üåßÔ∏è", bgClass: "rain" },
      65: { desc: "Lluvia intensa", icon: "üåßÔ∏è", bgClass: "rain" },
      66: { desc: "Lluvia helada ligera", icon: "üåßÔ∏è", bgClass: "sleet" },
      67: { desc: "Lluvia helada", icon: "üåßÔ∏è", bgClass: "sleet" },
      71: { desc: "Nieve ligera", icon: "‚ùÑÔ∏è", bgClass: "snow" },
      73: { desc: "Nieve", icon: "‚ùÑÔ∏è", bgClass: "snow" },
      75: { desc: "Nieve intensa", icon: "‚ùÑÔ∏è", bgClass: "snow" },
      77: { desc: "Granizos", icon: "‚ùÑÔ∏è", bgClass: "snow" },
      80: { desc: "Chubascos ligeros", icon: "üå¶Ô∏è", bgClass: "rain" },
      81: { desc: "Chubascos", icon: "üåßÔ∏è", bgClass: "rain" },
      82: { desc: "Chubascos intensos", icon: "üåßÔ∏è", bgClass: "rain" },
      85: { desc: "Nevadas ligeras", icon: "‚ùÑÔ∏è", bgClass: "snow" },
      86: { desc: "Nevadas", icon: "‚ùÑÔ∏è", bgClass: "snow" },
      95: { desc: "Tormenta", icon: "‚õàÔ∏è", bgClass: "thunderstorm" },
      96: { desc: "Tormenta con granizo", icon: "‚õàÔ∏è", bgClass: "thunderstorm" },
      99: { desc: "Tormenta intensa", icon: "‚õàÔ∏è", bgClass: "thunderstorm" }
    };
    // Ciudades mexicanas con coordenadas (usaremos la primera para el flash)
    const ciudades = [
      {
        nombre: "Villahermosa",
        lat: 17.99,
        lon: -92.93
      },      
      {
        nombre: "Ciudad del Carmen",
        lat: 18.63,
        lon: -91.83
      },
      {
        nombre: "M√©rida",
        lat: 20.97,
        lon: -89.59
      }
    ];
    const container = document.getElementById('media-container');
    const tickerContent = document.getElementById('ticker-content');
    const loadingDiv = document.getElementById('loading');
    const infoFlash = document.getElementById('info-flash');
    const flashTime = document.getElementById('flash-time');
    const flashDate = document.getElementById('flash-date');
    const flashCity = document.getElementById('flash-city');
    const flashTemp = document.getElementById('flash-temp');
    const flashWeatherIcon = document.getElementById('flash-weather-icon');
    const flashWeatherDesc = document.getElementById('flash-weather-desc');
    const flashWind = document.getElementById('flash-wind');
    const startButtonContainer = document.getElementById('start-button-container');
    const startButton = document.getElementById('start-button');
    
    let mediaFiles = [];
    let currentIndex = 0;
    let mostrarFlash = false;
    let ciudadActual = 0;
    
    // Variables para controlar el intervalo de im√°genes
    let mediaInterval = null;
    let flashInterval = null;
    
    // Avisos para la cinta
    const avisos = [
      "COPIAS",
      "IMPRESIONES", 
      "PLOTTEO",
      "ESCANEOS",
      "ENGARGOLADO",
      "ENCUADERNACION",
      "DISE√ëO GR√ÅFICO",
      "FOTOCOPIAS A COLOR",
      "LONAS",
      "IMPRESION EN VINIL",
      "IMPRESION DE ETIQUETAS",
      "ENMICADOS",
      "PAPELERIA"
    ];
    
    // Registrar Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('SW registrado'))
          .catch(err => console.log('SW error:', err));
      });
    }
    
    // Crear cinta de avisos
    function createTicker() {
      tickerContent.innerHTML = '';
      // Crear elementos duplicados para animaci√≥n infinita
      for (let i = 0; i < 2; i++) {
        avisos.forEach(aviso => {
          const item = document.createElement('div');
          item.className = 'ticker-item';
          item.textContent = aviso;
          tickerContent.appendChild(item);
        });
      }
    }
    
    // Actualizar hora en tiempo real para el flash
    function updateFlashClock() {
      const ahora = new Date();
      const hora = ahora.toLocaleTimeString('es-MX', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      });
      const fecha = ahora.toLocaleDateString('es-MX', {
        weekday: 'long',
        day: 'numeric',
        month: 'long',
        year: 'numeric'
      });
      flashTime.textContent = hora;
      flashDate.textContent = fecha;
    }
    
    // Obtener clima usando Open-Meteo
    async function obtenerClima(ciudad) {
      try {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${ciudad.lat}&longitude=${ciudad.lon}&current=temperature_2m,wind_speed_10m,weather_code`;
        const response = await fetch(url);
        const data = await response.json();
        if (data.current) {
          const temp = data.current.temperature_2m;
          const wind = data.current.wind_speed_10m;
          const code = data.current.weather_code;
          const weather = weatherMap[code] || { desc: "Desconocido", icon: "üå°Ô∏è", bgClass: "default" };
          
          flashCity.textContent = ciudad.nombre;
          flashTemp.textContent = `${temp}¬∞C`;
          flashWeatherDesc.textContent = weather.desc;
          flashWeatherIcon.textContent = weather.icon;
          flashWind.textContent = `Viento: ${wind} km/h`;
          
          // Aplicar el fondo correspondiente al clima
          // Primero, eliminar cualquier clase de fondo anterior
          infoFlash.className = infoFlash.className.replace(/flash-bg\s\S+/g, '').trim();
          // Agregar la nueva clase de fondo
          infoFlash.classList.add('flash-bg', weather.bgClass);
          
          return true;
        } else {
          throw new Error('Datos no disponibles');
        }
      } catch (error) {
        console.error('Error al obtener clima:', error);
        flashCity.textContent = ciudad.nombre;
        flashTemp.textContent = "--¬∞C";
        flashWeatherDesc.textContent = "Error al cargar";
        flashWeatherIcon.textContent = "üå°Ô∏è";
        flashWind.textContent = "Viento: -- km/h";
        
        // En caso de error, aplicar fondo por defecto
        infoFlash.className = infoFlash.className.replace(/flash-bg\s\S+/g, '').trim();
        infoFlash.classList.add('flash-bg', 'default');
        
        return false;
      }
    }
    
    // Mostrar flash informativo para una ciudad espec√≠fica
    async function mostrarFlashCiudad(index) {
      return new Promise(async (resolve) => {
        // Actualizar hora
        updateFlashClock();
        // Obtener y mostrar clima para la ciudad espec√≠fica
        await obtenerClima(ciudades[index]);
        resolve();
      });
    }
    
    // Mostrar flash informativo con todas las ciudades
    async function mostrarFlashInformativo() {
      console.log("Iniciando flash informativo");
      
      // Pausar el intervalo de im√°genes
      if (mediaInterval) {
        clearInterval(mediaInterval);
        mediaInterval = null;
        console.log("Intervalo de im√°genes pausado");
      }
      
      // Ocultar contenido multimedia
      container.innerHTML = '';
      container.appendChild(infoFlash);
      infoFlash.style.display = 'flex';
      
      // Duraci√≥n por ciudad: 7 segundos
      const tiempoPorCiudad = 7000;
      const numCiudades = ciudades.length;
      const tiempoTotal = numCiudades * tiempoPorCiudad;
      
      console.log(`Mostrando ${numCiudades} ciudades por ${tiempoPorCiudad/1000} segundos cada una. Tiempo total: ${tiempoTotal/1000} segundos`);
      
      // Mostrar cada ciudad secuencialmente
      for (let i = 0; i < ciudades.length; i++) {
        console.log(`Mostrando ciudad ${i + 1}: ${ciudades[i].nombre}`);
        await mostrarFlashCiudad(i);
        
        // Esperar el tiempo asignado para esta ciudad, a menos que sea la √∫ltima
        if (i < ciudades.length - 1) {
          await new Promise(resolve => setTimeout(resolve, tiempoPorCiudad));
        }
      }
      
      // Mantener la √∫ltima ciudad visible por el tiempo restante
      console.log("Manteniendo √∫ltima ciudad visible");
      await new Promise(resolve => setTimeout(resolve, tiempoPorCiudad));
      
      // Volver al contenido multimedia
      console.log("Finalizando flash informativo y volviendo al contenido multimedia");
      infoFlash.style.display = 'none';
      showMedia();
      
      // Reanudar el intervalo de im√°genes
      console.log("Reanudando intervalo de im√°genes");
      mediaInterval = setInterval(nextMedia, 10000);
    }
    
    // Mostrar contenido multimedia
    function showMedia() {
      container.innerHTML = '';
      if (mediaFiles.length === 0) {
        container.innerHTML = '<div id="loading">No hay archivos multimedia</div>';
        return;
      }
      const file = mediaFiles[currentIndex];
      const ext = file.split('.').pop().toLowerCase();
      if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) {
        const img = document.createElement('img');
        img.src = file;
        img.className = 'media-item';
        container.appendChild(img);
      } else if (['mp4', 'webm', 'mov'].includes(ext)) {
        const video = document.createElement('video');
        video.src = file;
        video.autoplay = true;
        video.loop = true;
        // video.muted = true; // Eliminamos muted para que tenga audio
        video.className = 'media-item';
        video.controls = false; // Ocultar controles
        container.appendChild(video);
        
        // Intentar reproducir el video con audio
        video.play().catch(error => {
          console.log("No se pudo reproducir el video con audio:", error);
          // Si falla, mostrar mensaje en consola pero continuar
        });
      }
    }
    
    function nextMedia() {
      if (mediaFiles.length > 0) {
        currentIndex = (currentIndex + 1) % mediaFiles.length;
        showMedia();
      }
    }
    
    // Obtener lista de archivos del repositorio
    async function fetchMediaFiles() {
      try {
        const response = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${REPO_NAME}/contents`);
        const files = await response.json();
        if (files.message) {
          throw new Error(files.message);
        }
        // Filtrar solo im√°genes y videos
        mediaFiles = files
          .filter(file => {
            const ext = file.name.split('.').pop().toLowerCase();
            return ['jpg', 'jpeg', 'png', 'gif', 'mp4', 'webm', 'mov'].includes(ext);
          })
          .map(file => file.download_url);
        if (mediaFiles.length > 0) {
          // No iniciamos el intervalo aqu√≠, se iniciar√° al presionar el bot√≥n
          console.log("Archivos cargados. Esperando bot√≥n de inicio.");
        } else {
          container.innerHTML = '<div id="loading">No hay archivos multimedia en la carpeta</div>';
        }
      } catch (error) {
        container.innerHTML = `
          <div id="loading" style="color:#ff6b6b">
            Error: Verifica configuraci√≥n de GitHub
          </div>
        `;
        console.error('Error:', error);
      }
    }
    
    // Funci√≥n para iniciar la presentaci√≥n
    function iniciarPresentacion() {
      // Ocultar el bot√≥n de inicio
      startButtonContainer.style.display = 'none';
      
      // Mostrar el primer contenido
      showMedia();
      
      // Iniciar el intervalo de im√°genes
      mediaInterval = setInterval(nextMedia, 10000);
      
      // Iniciar el intervalo del flash informativo (cada 15 minutos)
      flashInterval = setInterval(() => {
        mostrarFlashInformativo();
      }, 900000); // 15 minutos
      
      // Mostrar flash informativo inmediatamente
      setTimeout(() => {
        mostrarFlashInformativo();
      }, 3000); // Mostrar despu√©s de 3 segundos de carga
      
      // Actualizar reloj del flash cada segundo cuando est√° visible
      setInterval(updateFlashClock, 1000);
      
      console.log("Presentaci√≥n iniciada");
    }
    
    // Evento para el bot√≥n de inicio
    startButton.addEventListener('click', iniciarPresentacion);
    
    // Iniciar cuando la p√°gina cargue
    window.addEventListener('load', () => {
      createTicker();
      fetchMediaFiles();
    });
  </script>
</body>
</html>
